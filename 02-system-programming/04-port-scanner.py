#!/usr/bin/env python
#
# Usage: port-scanner.py <ip>
# Scans ports 0-65535 and prints ones that are listening
# Program does SYN scanning that actually establishes a connection.
# Multithreaded!

import os
import socket
import sys
from threading import Thread

thread_batches = []
ip = sys.argv[1]
open_ports = []

def worker_thread(port):
    s = socket.socket()
    s.settimeout(0.5)
    response = os.strerror(s.connect_ex(('192.168.1.1', port)))
    if response == 'Success':
        open_ports.append(port)
        print 'Success for port %d!' % port

for i in range(256):
    batch = []
    for j in range(256):
        batch.append(Thread(target=worker_thread, args=[i*256 + j]))
    thread_batches.append(batch)

for batch in thread_batches:
    for t in batch:
        t.start()

    for t in batch:
        t.join()

print "Done!"
