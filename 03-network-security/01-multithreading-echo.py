#!/usr/bin/env python
# Echo server using multithreading, can accept more than one client
# Supports up to 5 clients simultaneously

import signal
import socket
import threading

tcpSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
tcpSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

HOST = "0.0.0.0"
PORT = 8000
tcpSocket.bind((HOST, PORT))
tcpSocket.listen(1)

class WorkerThread(threading.Thread):
	def __init__(self):
		threading.Thread.__init__(self)

	def run(self):
		while True:
			(client, addr) = tcpSocket.accept()
			print "Client connected! From ", addr

			client.send("Connection established!\n")
			data = client.recv(2048)
			while data:
				client.send(data)
				data = client.recv(2048)

for i in range(5):
	worker = WorkerThread()	
	worker.setDaemon(True)
	worker.start()

def exit_handler(signum, frm):
	print "Terminating..."
	exit()
signal.signal(signal.SIGINT, exit_handler)

while True:
	pass
